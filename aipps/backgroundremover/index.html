<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºèƒ½æŠ å›¾ (å…ä¸‹è½½ç‰ˆ)</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f0f4f8; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; color: #333; }
        .container { max-width: 800px; width: 100%; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .nav { width: 100%; max-width: 800px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .back-link { text-decoration: none; color: #666; font-weight: 500; }
        
        /* å¼ºåˆ¶å›¾æ ‡å¤§å° */
        .icon-box svg { width: 60px; height: 60px; color: #cbd5e1; margin-bottom: 15px; }
        
        .upload-area { 
            border: 2px dashed #cbd5e1; border-radius: 16px; padding: 50px 20px; text-align: center; 
            cursor: pointer; background: #f8fafc; transition: all 0.2s; 
        }
        .upload-area:hover { border-color: #2563eb; background: #eff6ff; }
        .upload-area:hover .icon-box svg { color: #2563eb; }
        
        .btn { 
            width: 100%; background: #2563eb; color: white; border: none; padding: 16px; border-radius: 12px; 
            font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px; 
        }
        .btn:disabled { background: #94a3b8; cursor: not-allowed; }
        
        #status { text-align: center; margin-top: 15px; color: #2563eb; font-size: 14px; min-height: 20px;}
        
        .result-grid { display: none; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
        .img-box { background: #eee; border-radius: 8px; overflow: hidden; height: 300px; display: flex; align-items: center; justify-content: center; border: 1px solid #e2e8f0; }
        img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .checkerboard {
            background-image: linear-gradient(45deg, #e2e8f0 25%, transparent 25%), linear-gradient(-45deg, #e2e8f0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #e2e8f0 75%), linear-gradient(-45deg, transparent 75%, #e2e8f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        
        @media(max-width:600px){ .result-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="nav">
        <div style="font-weight:800; font-size:20px;">Aifura Tools</div>
        <a href="/" class="back-link">è¿”å›é¦–é¡µ</a>
    </div>

    <div class="container">
        <h1 style="text-align:center; margin-bottom:10px;">AI æ™ºèƒ½ä¸€é”®æŠ å›¾</h1>
        <p style="text-align:center; color:#666; margin-bottom:30px;">å…è´¹ã€æ— é™ã€æœ¬åœ°è¿è¡Œ (éšç§ä¿æŠ¤)</p>

        <div class="upload-area" id="uploadArea">
            <input type="file" id="fileInput" accept="image/*" style="display:none">
            <div class="icon-box">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
            </div>
            <div style="font-weight:600; font-size:18px;">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</div>
        </div>

        <button id="processBtn" class="btn" disabled>è¯·å…ˆä¸Šä¼ å›¾ç‰‡</button>
        <div id="status"></div>

        <div class="result-grid" id="resultArea">
            <div>
                <div style="font-size:12px; font-weight:700; color:#64748b; margin-bottom:5px;">åŸå›¾</div>
                <div class="img-box"><img id="imgOriginal"></div>
            </div>
            <div>
                <div style="font-size:12px; font-weight:700; color:#64748b; margin-bottom:5px;">æŠ å›¾ç»“æœ</div>
                <div class="img-box checkerboard"><img id="imgResult"></div>
                <a id="downloadBtn" class="btn" style="margin-top:10px; padding:12px; text-decoration:none; display:block; text-align:center; background:#10b981;">ä¸‹è½½å›¾ç‰‡</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.3.0/dist/imgly-background-removal.min.js"></script>

    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const processBtn = document.getElementById('processBtn');
        const status = document.getElementById('status');
        const resultArea = document.getElementById('resultArea');
        const imgOriginal = document.getElementById('imgOriginal');
        const imgResult = document.getElementById('imgResult');
        const downloadBtn = document.getElementById('downloadBtn');
        let selectedFile = null;

        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => { if(e.target.files[0]) handleFile(e.target.files[0]) });
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.style.background = '#eff6ff'; });
        uploadArea.addEventListener('dragleave', (e) => { e.preventDefault(); uploadArea.style.background = '#f8fafc'; });
        uploadArea.addEventListener('drop', (e) => { e.preventDefault(); if(e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]) });

        function handleFile(file) {
            selectedFile = file;
            imgOriginal.src = URL.createObjectURL(file);
            status.textContent = `å·²é€‰: ${file.name}`;
            processBtn.disabled = false;
            processBtn.textContent = "å¼€å§‹ä¸€é”®æŠ å›¾";
            resultArea.style.display = 'none';
        }

        processBtn.addEventListener('click', async () => {
            if(!selectedFile) return;

            // æ£€æŸ¥åº“æ˜¯å¦åŠ è½½
            if(typeof imglyRemoveBackground === 'undefined') {
                alert("AI æ ¸å¿ƒåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åˆ é™¤ _headers æ–‡ä»¶ï¼");
                return;
            }

            processBtn.disabled = true;
            processBtn.textContent = "å¤„ç†ä¸­...";
            status.textContent = "ğŸš€ æ­£åœ¨ä¸‹è½½æ¨¡å‹å¹¶å¤„ç† (é¦–æ¬¡çº¦éœ€ 20 ç§’)...";
            
            try {
                // è°ƒç”¨å…¨å±€å‡½æ•° imglyRemoveBackground
                const blob = await imglyRemoveBackground(selectedFile, {
                    progress: (key, current, total) => {
                         const percent = Math.round((current / total) * 100);
                         status.textContent = `â³ æ­£åœ¨åŠ è½½ç»„ä»¶: ${percent}%`;
                    }
                });
                
                const url = URL.createObjectURL(blob);
                imgResult.src = url;
                downloadBtn.href = url;
                downloadBtn.download = "cut_" + selectedFile.name;
                
                resultArea.style.display = 'grid';
                status.textContent = "âœ¨ å¤„ç†æˆåŠŸï¼";
                status.style.color = "green";
            } catch (error) {
                console.error(error);
                status.textContent = "âŒ å‡ºé”™: " + error.message;
                status.style.color = "red";
                alert("å‡ºé”™å•¦ï¼\n1. è¯·åŠ¡å¿…ç¡®è®¤å·²åˆ é™¤ GitHub æ ¹ç›®å½•çš„ _headers æ–‡ä»¶ã€‚\n2. å°è¯•ä½¿ç”¨ç”µè„‘æµè§ˆå™¨è®¿é—®ã€‚");
            } finally {
                processBtn.disabled = false;
                processBtn.textContent = "å†è¯•ä¸€æ¬¡";
            }
        });
    </script>
</body>
</html>
