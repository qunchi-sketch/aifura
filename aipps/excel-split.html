<!DOCTYPE html>
<html lang="zh">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2L2QE301LP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2L2QE301LP');
</script>
  <meta charset="UTF-8" />
  <title>Excel å·¥ä½œè¡¨ä¸€é”®æ‹†åˆ†å·¥å…· | Excel Sheet Splitter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="ä¸Šä¼ ä¸€ä¸ª Excel æ–‡ä»¶ï¼Œä¸€é”®å°†å…¶ä¸­çš„æ‰€æœ‰å·¥ä½œè¡¨æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ Excel æ–‡ä»¶ï¼Œæˆ–å•ç‹¬å¯¼å‡ºæŸä¸ªå·¥ä½œè¡¨ã€‚Support Chinese & English." />

<!-- SheetJS (xlsx) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- JSZip for zip files -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>


  <style>
    :root {
      --bg: #0f172a;
      --bg-soft: #111827;
      --card: #020617;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.15);
      --border: #1f2937;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --danger: #f97373;
      --radius-lg: 18px;
      --radius-full: 999px;
      --shadow-soft: 0 20px 40px rgba(15, 23, 42, 0.65);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .app-shell {
      width: 100%;
      max-width: 880px;
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), rgba(2, 6, 23, 0.98));
      border-radius: 28px;
      border: 1px solid rgba(148, 163, 184, 0.2);
      box-shadow: var(--shadow-soft);
      padding: 22px 22px 20px;
      backdrop-filter: blur(18px);
    }

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
      gap: 8px;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .app-title {
      font-size: 1.4rem;
      font-weight: 650;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      font-size: 0.72rem;
      padding: 2px 9px;
      border-radius: 999px;
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.25), rgba(59, 130, 246, 0.1));
      border: 1px solid rgba(129, 140, 248, 0.5);
      color: #e0f2fe;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .app-subtitle {
      font-size: 0.84rem;
      color: var(--text-soft);
    }

    .lang-toggle {
      display: inline-flex;
      padding: 3px;
      background: rgba(15, 23, 42, 0.9);
      border-radius: var(--radius-full);
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.8);
      gap: 3px;
    }

    .lang-btn {
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: 0.8rem;
      padding: 5px 11px;
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .lang-btn.active {
      background: radial-gradient(circle at top, var(--accent), #1d4ed8);
      color: white;
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.8);
    }

    .lang-btn:not(.active):hover {
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
    }

    .app-body {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 18px;
    }

    @media (max-width: 820px) {
      .app-body {
        grid-template-columns: minmax(0, 1fr);
      }
      .app-shell {
        padding: 18px 16px 16px;
      }
      .app-header {
        align-items: flex-start;
      }
    }

    .panel {
      background: radial-gradient(circle at top left, rgba(15, 118, 255, 0.12), rgba(15, 23, 42, 0.9));
      border-radius: var(--radius-lg);
      padding: 14px 14px 12px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 10% 0, rgba(56, 189, 248, 0.17), transparent 55%),
        radial-gradient(circle at 95% 10%, rgba(129, 140, 248, 0.18), transparent 52%);
      opacity: 0.75;
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
    }

    .panel-heading {
      font-size: 0.9rem;
      font-weight: 550;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .badge-soft {
      font-size: 0.72rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-soft);
    }

    .drop-zone {
      margin-top: 6px;
      padding: 20px 14px;
      border-radius: 16px;
      border: 1px dashed rgba(148, 163, 184, 0.8);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), rgba(2, 6, 23, 0.98));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      cursor: pointer;
      transition: all 0.18s ease;
      gap: 6px;
      position: relative;
    }

    .drop-zone.drag-over {
      border-style: solid;
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(37, 99, 235, 0.25), rgba(15, 23, 42, 0.95));
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.9), 0 18px 35px rgba(30, 64, 175, 0.6);
      transform: translateY(-1px);
    }

    .drop-icon {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, rgba(129, 140, 248, 0.7), rgba(37, 99, 235, 0.9));
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2px;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.7);
    }

    .drop-icon span {
      font-size: 20px;
    }

    .drop-title {
      font-size: 0.95rem;
      font-weight: 520;
    }

    .drop-sub {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .choose-btn {
      margin-top: 6px;
      font-size: 0.8rem;
      padding: 5px 14px;
      border-radius: 999px;
      border: none;
      background: rgba(15, 23, 42, 0.96);
      color: var(--text);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.5);
      transition: all 0.16s ease;
    }

    .choose-btn:hover {
      background: rgba(15, 23, 42, 1);
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.9);
      transform: translateY(-0.5px);
    }

    /* è®© <input type=file> å®Œå…¨é€æ˜é“ºåœ¨ drop-zone ä¸Šï¼Œä»»ä½•ä½ç½®ç‚¹å‡»éƒ½èƒ½å¼¹çª— */
    #file-input {
      position: absolute;
      inset: 0;
      opacity: 0;
      cursor: pointer;
    }

    .meta-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .meta-label {
      opacity: 0.85;
    }

    .meta-value {
      color: #e5e7eb;
    }

    .meta-file {
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .panel-divider {
      height: 1px;
      background: radial-gradient(circle at left, rgba(148, 163, 184, 0.6), transparent 70%);
      margin: 12px -12px 12px;
      opacity: 0.85;
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
    }

    .btn-primary,
    .btn-ghost {
      border-radius: 999px;
      border: none;
      cursor: pointer;
      padding: 7px 13px;
      font-size: 0.82rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: all 0.16s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: white;
      box-shadow:
        0 0 0 1px rgba(191, 219, 254, 0.4),
        0 14px 25px rgba(37, 99, 235, 0.55);
    }

    .btn-primary:hover {
      filter: brightness(1.06);
      transform: translateY(-0.5px);
      box-shadow:
        0 0 0 1px rgba(239, 246, 255, 0.9),
        0 18px 32px rgba(30, 64, 175, 0.75);
    }

    .btn-primary:disabled,
    .btn-ghost:disabled {
      opacity: 0.45;
      cursor: default;
      box-shadow: none;
      transform: none;
    }

    .btn-ghost {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text);
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.6);
    }

    .btn-ghost:hover:not(:disabled) {
      background: rgba(15, 23, 42, 1);
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.95);
      transform: translateY(-0.5px);
    }

    .btn-icon {
      font-size: 1rem;
    }

    .right-panel {
      background: radial-gradient(circle at top right, rgba(30, 64, 175, 0.3), rgba(15, 23, 42, 0.98));
      border-radius: var(--radius-lg);
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 12px 12px 10px;
      position: relative;
      overflow: hidden;
    }

    .right-panel::before {
      content: "";
      position: absolute;
      inset: -35%;
      background:
        radial-gradient(circle at 80% 0, rgba(129, 230, 217, 0.18), transparent 60%),
        radial-gradient(circle at 0 80%, rgba(59, 130, 246, 0.18), transparent 60%);
      opacity: 0.8;
      pointer-events: none;
    }

    .right-inner {
      position: relative;
      z-index: 1;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 550;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
    }

    .status-text {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .sheet-list {
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(75, 85, 99, 0.9);
      padding: 8px 8px 6px;
      max-height: 180px;
      overflow: auto;
      font-size: 0.8rem;
    }

    .sheet-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 5px 5px;
      border-radius: 10px;
      cursor: default;
      gap: 8px;
    }

    .sheet-item:nth-child(even) {
      background: rgba(15, 23, 42, 0.9);
    }

    .sheet-name {
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 0;
    }

    .sheet-tag {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(37, 99, 235, 0.16);
      border: 1px solid rgba(96, 165, 250, 0.85);
      color: #dbeafe;
    }

    .sheet-label {
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .sheet-meta {
      font-size: 0.72rem;
      color: var(--text-soft);
      white-space: nowrap;
    }

    .no-sheets {
      font-size: 0.8rem;
      color: var(--text-soft);
      padding: 4px 2px;
    }

    .select-row {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
      align-items: center;
    }

    .select-row label {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .select-row select {
      background: rgba(15, 23, 42, 0.98);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 5px 10px;
      font-size: 0.8rem;
      color: var(--text);
      outline: none;
      min-width: 120px;
    }

    .select-row select:disabled {
      opacity: 0.45;
    }

    .status-area {
      margin-top: 6px;
      font-size: 0.76rem;
      color: var(--text-soft);
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .status-main {
      color: #bfdbfe;
    }

    .status-error {
      color: #fecaca;
    }

    .status-hint {
      opacity: 0.9;
    }

    .footer-note {
      margin-top: 8px;
      font-size: 0.72rem;
      color: var(--text-soft);
      text-align: right;
    }

    .footer-note span {
      opacity: 0.9;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="title-block">
        <div class="app-title">
          <span id="app-title">Excel å·¥ä½œè¡¨ä¸€é”®æ‹†åˆ†</span>
          <span class="pill">AIPP</span>
        </div>
        <div class="app-subtitle" id="app-subtitle">
          ä¸Šä¼ ä¸€ä¸ª Excel æ–‡ä»¶ï¼Œä¸€é”®æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å·¥ä½œè¡¨æ–‡ä»¶ï¼Œæˆ–å•ç‹¬å¯¼å‡ºæŸä¸ª Sheetã€‚
        </div>
      </div>
      <div class="lang-toggle" aria-label="Language toggle">
        <button id="lang-zh" class="lang-btn active" type="button">
          ğŸ‡¨ğŸ‡³ ä¸­æ–‡
        </button>
        <button id="lang-en" class="lang-btn" type="button">
          ğŸ‡ºğŸ‡¸ EN
        </button>
      </div>
    </header>

    <main class="app-body">
      <!-- Left: upload & main actions -->
      <section class="panel">
        <div class="panel-inner">
          <div class="panel-heading">
            <span id="panel-upload-title">1. ä¸Šä¼  Excel æ–‡ä»¶</span>
            <span class="badge-soft" id="panel-upload-badge">æ”¯æŒ .xlsx / .xls</span>
          </div>

          <div id="drop-zone" class="drop-zone">
            <div class="drop-icon">
              <span>ğŸ“‚</span>
            </div>
            <div class="drop-title" id="drop-title">
              ç‚¹å‡»æˆ–æ‹–æ‹½ Excel æ–‡ä»¶åˆ°è¿™é‡Œ
            </div>
            <div class="drop-sub" id="drop-sub">
              æˆ‘ä»¬ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ‰€æœ‰å¤„ç†åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆã€‚
            </div>

            <!-- çœŸæ­£çš„æ–‡ä»¶è¾“å…¥ï¼Œé€æ˜è¦†ç›–æ•´ä¸ªåŒºåŸŸ -->
            <input id="file-input" type="file" accept=".xlsx,.xls" />

            <button class="choose-btn" type="button">
              <span>â¬†ï¸</span>
              <span id="choose-btn-text">é€‰æ‹©æ–‡ä»¶</span>
            </button>
          </div>

          <div class="meta-row">
            <div>
              <span class="meta-label" id="meta-file-label">å½“å‰æ–‡ä»¶ï¼š</span>
              <span class="meta-value meta-file" id="meta-file-name">å°šæœªé€‰æ‹©</span>
            </div>
            <div id="meta-sheet-wrapper" style="display:none;">
              <span class="meta-label" id="meta-sheet-label">å·¥ä½œè¡¨æ•°é‡ï¼š</span>
              <span class="meta-value" id="meta-sheet-count">0</span>
            </div>
          </div>

          <div class="panel-divider"></div>

          <div class="actions">
            <button id="btn-split-all" class="btn-primary" type="button" disabled>
              <span class="btn-icon">ğŸ§©</span>
              <span id="btn-split-all-text">ä¸€é”®æ‹†åˆ†æ‰€æœ‰å·¥ä½œè¡¨ï¼ˆä¸‹è½½ ZIPï¼‰</span>
            </button>

            <button id="btn-download-one" class="btn-ghost" type="button" disabled>
              <span class="btn-icon">ğŸ“„</span>
              <span id="btn-download-one-text">å¯¼å‡ºé€‰ä¸­ Sheet</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Right: sheet list & status -->
      <section class="right-panel">
        <div class="right-inner">
          <div class="section-title">
            <span id="sheet-panel-title">2. é€‰æ‹©è¦å¯¼å‡ºçš„ Sheet</span>
            <div class="status-text">
              <span class="status-dot"></span>
              <span id="status-label">æœ¬åœ°å¤„ç† Â· æ— éœ€ä¸Šä¼ </span>
            </div>
          </div>

          <div class="sheet-list" id="sheet-list">
            <div class="no-sheets" id="no-sheets-text">
              å°šæœªåŠ è½½ Excel æ–‡ä»¶ï¼Œè¯·å…ˆåœ¨å·¦ä¾§ä¸Šä¼ ã€‚
            </div>
          </div>

          <div class="select-row">
            <label for="sheet-select" id="sheet-select-label">é€‰æ‹©è¦å•ç‹¬å¯¼å‡ºçš„ Sheetï¼š</label>
            <select id="sheet-select" disabled>
              <option value="" id="sheet-select-placeholder">è¯·é€‰æ‹©å·¥ä½œè¡¨</option>
            </select>
          </div>

          <div class="status-area">
            <div id="status-main" class="status-main">
              âœ… å°±ç»ªï¼šè¯·ä¸Šä¼  Excel æ–‡ä»¶å¼€å§‹ã€‚
            </div>
            <div id="status-extra" class="status-hint">
              å°æç¤ºï¼šè¡¨æ ¼è¿‡å¤§æ—¶åœ¨æµè§ˆå™¨å¤„ç†ä¸­å¯èƒ½ç¨æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚
            </div>
          </div>

          <div class="footer-note">
            <span id="footer-note-text">
              Created by Qun Â· æœ¬å·¥å…·å®Œå…¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­è¿è¡Œ Â· æ›´å¤šå¥½ç”¨å·¥å…·è¯·è®¿é—® aifura.com
            </span>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    (function () {
      const i18n = {
        zh: {
          appTitle: "Excel å·¥ä½œè¡¨ä¸€é”®æ‹†åˆ†",
          appSubtitle: "ä¸Šä¼ ä¸€ä¸ª Excel æ–‡ä»¶ï¼Œä¸€é”®æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„å·¥ä½œè¡¨æ–‡ä»¶ï¼Œæˆ–å•ç‹¬å¯¼å‡ºæŸä¸ª Sheetã€‚",
          uploadTitle: "1. ä¸Šä¼  Excel æ–‡ä»¶",
          uploadBadge: "æ”¯æŒ .xlsx / .xls",
          dropTitle: "ç‚¹å‡»æˆ–æ‹–æ‹½ Excel æ–‡ä»¶åˆ°è¿™é‡Œ",
          dropSub: "æˆ‘ä»¬ä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ‰€æœ‰å¤„ç†åœ¨æµè§ˆå™¨æœ¬åœ°å®Œæˆã€‚",
          chooseBtn: "é€‰æ‹©æ–‡ä»¶",
          metaFileLabel: "å½“å‰æ–‡ä»¶ï¼š",
          metaFileNone: "å°šæœªé€‰æ‹©",
          metaSheetLabel: "å·¥ä½œè¡¨æ•°é‡ï¼š",
          splitAllText: "ä¸€é”®æ‹†åˆ†æ‰€æœ‰å·¥ä½œè¡¨ï¼ˆä¸‹è½½ ZIPï¼‰",
          downloadOneText: "å¯¼å‡ºé€‰ä¸­ Sheet",
          sheetPanelTitle: "2. é€‰æ‹©è¦å¯¼å‡ºçš„ Sheet",
          statusLabel: "æœ¬åœ°å¤„ç† Â· æ— éœ€ä¸Šä¼ ",
          noSheetsText: "å°šæœªåŠ è½½ Excel æ–‡ä»¶ï¼Œè¯·å…ˆåœ¨å·¦ä¾§ä¸Šä¼ ã€‚",
          sheetSelectLabel: "é€‰æ‹©è¦å•ç‹¬å¯¼å‡ºçš„ Sheetï¼š",
          sheetSelectPlaceholder: "è¯·é€‰æ‹©å·¥ä½œè¡¨",
          statusReady: "âœ… å°±ç»ªï¼šè¯·ä¸Šä¼  Excel æ–‡ä»¶å¼€å§‹ã€‚",
          statusHint: "å°æç¤ºï¼šè¡¨æ ¼è¿‡å¤§æ—¶åœ¨æµè§ˆå™¨å¤„ç†ä¸­å¯èƒ½ç¨æ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚",
          footerNote: "Created by Qun Â· æœ¬å·¥å…·å®Œå…¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­è¿è¡Œ Â· æ›´å¤šå¥½ç”¨å·¥å…·è¯·è®¿é—® aifura.com",
          statusLoading: "â³ æ­£åœ¨è§£æ Excel æ–‡ä»¶ï¼Œè¯·ç¨å€™â€¦",
          statusLoaded: (name, count) =>
            `âœ… å·²åŠ è½½ã€Œ${name}ã€ï¼Œå…± ${count} ä¸ªå·¥ä½œè¡¨ã€‚`,
          statusSplittingAll: "â³ æ­£åœ¨æ‹†åˆ†æ‰€æœ‰å·¥ä½œè¡¨å¹¶æ‰“åŒ… ZIPâ€¦",
          statusDownloadingZip: "ğŸ“¦ æ­£åœ¨ç”Ÿæˆå¹¶ä¸‹è½½ ZIP æ–‡ä»¶â€¦",
          statusSplitDone: (count) =>
            `âœ… å·²æˆåŠŸæ‹†åˆ†å¹¶å‡†å¤‡ä¸‹è½½ ${count} ä¸ªå·¥ä½œè¡¨æ–‡ä»¶ï¼ˆZIPï¼‰ã€‚`,
          statusDownloadingOne: "ğŸ“„ æ­£åœ¨å¯¼å‡ºé€‰ä¸­çš„å·¥ä½œè¡¨â€¦",
          statusOneDone: (sheetName) =>
            `âœ… å·²æˆåŠŸå¯¼å‡ºå·¥ä½œè¡¨ã€Œ${sheetName}ã€ã€‚`,
          errorNoFile: "âš ï¸ è¯·å…ˆä¸Šä¼  Excel æ–‡ä»¶ã€‚",
          errorInvalidFile: "âš ï¸ æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·ä¸Šä¼  .xlsx æˆ– .xls æ–‡ä»¶ã€‚",
          errorNoSheets: "âš ï¸ æœªæ£€æµ‹åˆ°ä»»ä½•å·¥ä½œè¡¨ã€‚",
          errorNoSheetSelected: "âš ï¸ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè¦å¯¼å‡ºçš„å·¥ä½œè¡¨ã€‚",
          errorGeneral: "âš ï¸ å¤„ç†å‡ºç°é—®é¢˜ï¼Œè¯·ç¨åé‡è¯•ã€‚",
          errorLibs: "âš ï¸ ä¾èµ–åº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚"
        },
        en: {
          appTitle: "Excel Sheet Splitter",
          appSubtitle:
            "Upload a single Excel file, then split each sheet into its own workbook, or export one sheet only.",
          uploadTitle: "1. Upload Excel file",
          uploadBadge: "Supports .xlsx / .xls",
          dropTitle: "Click or drag an Excel file here",
          dropSub: "Nothing is uploaded to any server. Everything runs locally in your browser.",
          chooseBtn: "Choose file",
          metaFileLabel: "Current file:",
          metaFileNone: "No file selected",
          metaSheetLabel: "Sheets:",
          splitAllText: "Split all sheets (download ZIP)",
          downloadOneText: "Export selected sheet",
          sheetPanelTitle: "2. Choose sheet to export",
          statusLabel: "Local only Â· No upload",
          noSheetsText: "No Excel file loaded yet. Please upload on the left first.",
          sheetSelectLabel: "Sheet to export:",
          sheetSelectPlaceholder: "Select a sheet",
          statusReady: "âœ… Ready â€“ upload an Excel file to begin.",
          statusHint:
            "Tip: For very large workbooks, processing may take a bit longer in the browser.",
          footerNote: "Created by Qun Â· Runs 100% in your browser Â· More handy tools at aifura.com",
          statusLoading: "â³ Parsing Excel file, please waitâ€¦",
          statusLoaded: (name, count) =>
            `âœ… Loaded "${name}" with ${count} sheet(s).`,
          statusSplittingAll: "â³ Splitting all sheets and building ZIPâ€¦",
          statusDownloadingZip: "ğŸ“¦ Generating and downloading ZIP fileâ€¦",
          statusSplitDone: (count) =>
            `âœ… Successfully split and prepared ${count} sheet files (ZIP).`,
          statusDownloadingOne: "ğŸ“„ Exporting selected sheetâ€¦",
          statusOneDone: (sheetName) =>
            `âœ… Successfully exported sheet "${sheetName}".`,
          errorNoFile: "âš ï¸ Please upload an Excel file first.",
          errorInvalidFile:
            "âš ï¸ Unsupported file type. Please upload .xlsx or .xls.",
          errorNoSheets: "âš ï¸ No sheets were detected in this workbook.",
          errorNoSheetSelected: "âš ï¸ Please choose a sheet to export.",
          errorGeneral: "âš ï¸ Something went wrong. Please try again.",
          errorLibs: "âš ï¸ Failed to load XLSX/JSZip libraries. Please check your network."
        }
      };

      let currentLang = "zh";

      function $(id) {
        return document.getElementById(id);
      }

      const appTitle = $("app-title");
      const appSubtitle = $("app-subtitle");
      const panelUploadTitle = $("panel-upload-title");
      const panelUploadBadge = $("panel-upload-badge");
      const dropZone = $("drop-zone");
      const dropTitle = $("drop-title");
      const dropSub = $("drop-sub");
      const fileInput = $("file-input");
      const metaFileLabel = $("meta-file-label");
      const metaFileName = $("meta-file-name");
      const metaSheetWrapper = $("meta-sheet-wrapper");
      const metaSheetLabel = $("meta-sheet-label");
      const metaSheetCount = $("meta-sheet-count");
      const btnSplitAll = $("btn-split-all");
      const btnSplitAllText = $("btn-split-all-text");
      const btnDownloadOne = $("btn-download-one");
      const btnDownloadOneText = $("btn-download-one-text");
      const sheetPanelTitle = $("sheet-panel-title");
      const statusLabel = $("status-label");
      const sheetList = $("sheet-list");
      const noSheetsText = $("no-sheets-text");
      const sheetSelectLabel = $("sheet-select-label");
      const sheetSelect = $("sheet-select");
      const sheetSelectPlaceholder = $("sheet-select-placeholder");
      const statusMain = $("status-main");
      const statusExtra = $("status-extra");
      const footerNoteText = $("footer-note-text");
      const langZhBtn = $("lang-zh");
      const langEnBtn = $("lang-en");
      const chooseBtnText = $("choose-btn-text");

      let workbook = null;
      let sheetNames = [];
      let originalFileName = "";

      function libsReady() {
        return typeof XLSX !== "undefined" && typeof JSZip !== "undefined";
      }

      function applyLang(lang) {
        currentLang = lang;
        const t = i18n[lang];

        appTitle.textContent = t.appTitle;
        appSubtitle.textContent = t.appSubtitle;
        panelUploadTitle.textContent = t.uploadTitle;
        panelUploadBadge.textContent = t.uploadBadge;
        dropTitle.textContent = t.dropTitle;
        dropSub.textContent = t.dropSub;
        chooseBtnText.textContent = t.chooseBtn;
        metaFileLabel.textContent = t.metaFileLabel;
        if (!originalFileName) {
          metaFileName.textContent = t.metaFileNone;
        }
        metaSheetLabel.textContent = t.metaSheetLabel;
        btnSplitAllText.textContent = t.splitAllText;
        btnDownloadOneText.textContent = t.downloadOneText;
        sheetPanelTitle.textContent = t.sheetPanelTitle;
        statusLabel.textContent = t.statusLabel;
        if (!workbook) {
          noSheetsText.textContent = t.noSheetsText;
        }
        sheetSelectLabel.textContent = t.sheetSelectLabel;
        sheetSelectPlaceholder.textContent = t.sheetSelectPlaceholder;
        statusMain.textContent = t.statusReady;
        statusMain.className = "status-main";
        statusExtra.textContent = t.statusHint;
        footerNoteText.textContent = t.footerNote;

        langZhBtn.classList.toggle("active", lang === "zh");
        langEnBtn.classList.toggle("active", lang === "en");
      }

      function sanitizeFileName(name) {
        return name.replace(/[\\\/:*?"<>|]/g, "_");
      }

      function downloadBlob(blob, filename) {
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      langZhBtn.addEventListener("click", () => applyLang("zh"));
      langEnBtn.addEventListener("click", () => applyLang("en"));

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("drag-over");
      });

      dropZone.addEventListener("dragleave", (e) => {
        e.preventDefault();
        dropZone.classList.remove("drag-over");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("drag-over");
        const files = e.dataTransfer.files;
        if (files && files[0]) {
          handleFile(files[0]);
        }
      });

      fileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          handleFile(file);
        }
      });

      function resetWorkbookUI() {
        workbook = null;
        sheetNames = [];
        originalFileName = "";
        metaSheetWrapper.style.display = "none";
        metaSheetCount.textContent = "0";
        sheetList.innerHTML =
          `<div class="no-sheets" id="no-sheets-text">${i18n[currentLang].noSheetsText}</div>`;
        sheetSelect.innerHTML = "";
        const opt = document.createElement("option");
        opt.value = "";
        opt.id = "sheet-select-placeholder";
        opt.textContent = i18n[currentLang].sheetSelectPlaceholder;
        sheetSelect.appendChild(opt);
        sheetSelect.disabled = true;
        btnSplitAll.disabled = true;
        btnDownloadOne.disabled = true;
      }

      function handleFile(file) {
        const t = i18n[currentLang];

        if (!libsReady()) {
          statusMain.textContent = t.errorLibs;
          statusMain.className = "status-main status-error";
          return;
        }

        resetWorkbookUI();

        const ext = (file.name.split(".").pop() || "").toLowerCase();
        if (!(ext === "xlsx" || ext === "xls")) {
          statusMain.textContent = t.errorInvalidFile;
          statusMain.className = "status-main status-error";
          metaFileName.textContent = t.metaFileNone;
          return;
        }

        originalFileName = file.name.replace(/\.[^.]+$/, "");
        metaFileName.textContent = file.name;
        metaFileName.title = file.name;

        statusMain.textContent = t.statusLoading;
        statusMain.className = "status-main";

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const data = new Uint8Array(e.target.result);
            workbook = XLSX.read(data, { type: "array" });
            sheetNames = workbook.SheetNames || [];

            if (!sheetNames.length) {
              statusMain.textContent = t.errorNoSheets;
              statusMain.className = "status-main status-error";
              return;
            }

            metaSheetWrapper.style.display = "inline-block";
            metaSheetCount.textContent = sheetNames.length.toString();

            renderSheetList();

            btnSplitAll.disabled = false;
            btnDownloadOne.disabled = false;
            sheetSelect.disabled = false;

            statusMain.textContent = t.statusLoaded(file.name, sheetNames.length);
            statusMain.className = "status-main";
          } catch (err) {
            console.error(err);
            statusMain.textContent = t.errorGeneral;
            statusMain.className = "status-main status-error";
          }
        };
        reader.onerror = function () {
          statusMain.textContent = t.errorGeneral;
          statusMain.className = "status-main status-error";
        };
        reader.readAsArrayBuffer(file);
      }

      function renderSheetList() {
        const t = i18n[currentLang];
        sheetList.innerHTML = "";
        sheetSelect.innerHTML = "";

        if (!sheetNames.length) {
          const div = document.createElement("div");
          div.className = "no-sheets";
          div.textContent = t.noSheetsText;
          sheetList.appendChild(div);

          const opt = document.createElement("option");
          opt.value = "";
          opt.textContent = t.sheetSelectPlaceholder;
          sheetSelect.appendChild(opt);
          sheetSelect.disabled = true;
          return;
        }

        sheetNames.forEach((name, index) => {
          const row = document.createElement("div");
          row.className = "sheet-item";

          const left = document.createElement("div");
          left.className = "sheet-name";

          const tag = document.createElement("span");
          tag.className = "sheet-tag";
          tag.textContent = "#" + (index + 1);

          const label = document.createElement("span");
          label.className = "sheet-label";
          label.textContent = name;

          left.appendChild(tag);
          left.appendChild(label);

          const meta = document.createElement("div");
          meta.className = "sheet-meta";
          meta.textContent = "Sheet";

          row.appendChild(left);
          row.appendChild(meta);
          sheetList.appendChild(row);

          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          sheetSelect.appendChild(opt);
        });

        const placeholder = document.createElement("option");
        placeholder.value = "";
        placeholder.textContent = t.sheetSelectPlaceholder;
        sheetSelect.insertBefore(placeholder, sheetSelect.firstChild);
        sheetSelect.value = "";
      }

      btnSplitAll.addEventListener("click", async () => {
        const t = i18n[currentLang];
        if (!workbook || !sheetNames.length) {
          statusMain.textContent = t.errorNoFile;
          statusMain.className = "status-main status-error";
          return;
        }
        if (!libsReady()) {
          statusMain.textContent = t.errorLibs;
          statusMain.className = "status-main status-error";
          return;
        }

        try {
          btnSplitAll.disabled = true;
          btnDownloadOne.disabled = true;
          sheetSelect.disabled = true;
          statusMain.textContent = t.statusSplittingAll;
          statusMain.className = "status-main";

          const zip = new JSZip();

          sheetNames.forEach((sheetName) => {
            const ws = workbook.Sheets[sheetName];
            if (!ws) return;

            const newWb = XLSX.utils.book_new();
            const wsClone = JSON.parse(JSON.stringify(ws));
            XLSX.utils.book_append_sheet(newWb, wsClone, sheetName);

            const wbout = XLSX.write(newWb, {
              bookType: "xlsx",
              type: "array"
            });

            const safeSheetName = sanitizeFileName(sheetName || "Sheet");
            const safeBase = sanitizeFileName(originalFileName || "Workbook");
            const fileName = `${safeBase}_${safeSheetName}.xlsx`;
            zip.file(fileName, wbout);
          });

          statusMain.textContent = t.statusDownloadingZip;
          const zipBlob = await zip.generateAsync({ type: "blob" });

          const safeBase = sanitizeFileName(originalFileName || "Workbook");
          downloadBlob(zipBlob, `${safeBase}_sheets.zip`);

          statusMain.textContent = t.statusSplitDone(sheetNames.length);
          statusMain.className = "status-main";
        } catch (err) {
          console.error(err);
          statusMain.textContent = t.errorGeneral;
          statusMain.className = "status-main status-error";
        } finally {
          btnSplitAll.disabled = !workbook;
          btnDownloadOne.disabled = !workbook;
          sheetSelect.disabled = !workbook;
        }
      });

      btnDownloadOne.addEventListener("click", () => {
        const t = i18n[currentLang];
        if (!workbook || !sheetNames.length) {
          statusMain.textContent = t.errorNoFile;
          statusMain.className = "status-main status-error";
          return;
        }
        if (!libsReady()) {
          statusMain.textContent = t.errorLibs;
          statusMain.className = "status-main status-error";
          return;
        }

        const sheetName = sheetSelect.value;
        if (!sheetName) {
          statusMain.textContent = t.errorNoSheetSelected;
          statusMain.className = "status-main status-error";
          return;
        }

        const ws = workbook.Sheets[sheetName];
        if (!ws) {
          statusMain.textContent = t.errorGeneral;
          statusMain.className = "status-main status-error";
          return;
        }

        try {
          btnSplitAll.disabled = true;
          btnDownloadOne.disabled = true;
          sheetSelect.disabled = true;
          statusMain.textContent = t.statusDownloadingOne;
          statusMain.className = "status-main";

          const newWb = XLSX.utils.book_new();
          const wsClone = JSON.parse(JSON.stringify(ws));
          XLSX.utils.book_append_sheet(newWb, wsClone, sheetName);

          const wbout = XLSX.write(newWb, {
            bookType: "xlsx",
            type: "array"
          });

          const safeSheetName = sanitizeFileName(sheetName || "Sheet");
          const safeBase = sanitizeFileName(originalFileName || "Workbook");
          const fileName = `${safeBase}_${safeSheetName}.xlsx`;
          const blob = new Blob([wbout], { type: "application/octet-stream" });
          downloadBlob(blob, fileName);

          statusMain.textContent = t.statusOneDone(sheetName);
          statusMain.className = "status-main";
        } catch (err) {
          console.error(err);
          statusMain.textContent = t.errorGeneral;
          statusMain.className = "status-main status-error";
        } finally {
          btnSplitAll.disabled = !workbook;
          btnDownloadOne.disabled = !workbook;
          sheetSelect.disabled = !workbook;
        }
      });

      applyLang(currentLang);
    })();
  </script>
</body>
</html>
